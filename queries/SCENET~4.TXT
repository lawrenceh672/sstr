with
ALSSCNTM (ALSATSCN, INCIDENT, DIAG_CD) AS (
SELECT 	TIMESTAMPDIFF (2, CAST((TIMESTAMP(ARVSCN_DATE, ARVSCN_TIME)) -

 
	(SELECT	       TIMESTAMP(UU.DPTSCN_DATE, UU.DPTSCN_TIME)
	FROM 	FACCSDB.INCIDENT_UNITS1 UU,
	FACCSDB.PATIENTS1 PP,
	FACCSDB.DIAGCODES D
WHERE	PP.DIAG_CD IN D.DIAG_CD	AND
	UU.INCIDENT_CD = PP.INCIDENT_CD	AND
	UU.TYPE_CD = 'BLS'	AND
	UU.ARVSCN_DATE BETWEEN DATE('01/01/1999') AND DATE('06/30/1999')	AND
	UU.INCIDENT_CD IN U.INCIDENT_CD
	
	
) AS CHAR(22))) AS ALSATSCN,



	P.INCIDENT_CD AS INCIDENT,
	P.DIAG_CD AS DIAG_CD
FROM 	FACCSDB.INCIDENT_UNITS1 U,
	FACCSDB.PATIENTS1 P,
	FACCSDB.DIAGCODES D
WHERE	P.DIAG_CD IN D.DIAG_CD	AND
	U.INCIDENT_CD = P.INCIDENT_CD	AND
	U.TYPE_CD = 'ALS'	AND
	U.ARVSCN_DATE BETWEEN DATE('01/01/1999') AND DATE('06/30/1999')),

ILSSCNTM (ILSATSCN, INCIDENT, DIAG_CD) AS (
SELECT 	TIMESTAMPDIFF (2, CAST((TIMESTAMP(ARVSCN_DATE, ARVSCN_TIME)) - 
		       TIMESTAMP(DPTSCN_DATE, DPTSCN_TIME) AS CHAR(22))) AS ILSATSCN,
	P.INCIDENT_CD AS INCIDENT,
	P.DIAG_CD AS DIAG_CD
FROM 	FACCSDB.INCIDENT_UNITS1 U,
	FACCSDB.PATIENTS1 P,
	FACCSDB.DIAGCODES D
WHERE	P.DIAG_CD IN D.DIAG_CD	AND
	U.INCIDENT_CD = P.INCIDENT_CD	AND
	U.TYPE_CD = 'BLS'	AND
	U.ARVSCN_DATE BETWEEN DATE('01/01/1999') AND DATE('06/30/1999')),


INNERJOIN (INCIDENT_CD, ALSATSCN, ILSATSCN, DIAG_CD) AS
(SELECT A.INCIDENT AS INCIDENT_CD,
	ALSATSCN, 
	ILSATSCN,
	A.DIAG_CD
 FROM 	ALSSCNTM A, 
	ILSSCNTM I 
 WHERE 	A.ALSATSCN = I.ILSATSCN 	AND 
	A.INCIDENT=I.INCIDENT),

RIGHTOUTERJOIN (INCIDENT, ILSATSCN, DIAG_CD) AS
(SELECT I.INCIDENT, I.ILSATSCN,  I.DIAG_CD FROM ILSSCNTM I
 EXCEPT ALL
 SELECT INCIDENT_CD, ILSATSCN, DIAG_CD FROM INNERJOIN),

LEFTOUTERJOIN (INCIDENT, ALSATSCN, DIAG_CD) AS
(SELECT A.INCIDENT, A.ALSATSCN,  A.DIAG_CD FROM ALSSCNTM A
 EXCEPT ALL
 SELECT INCIDENT_CD, ALSATSCN, DIAG_CD FROM INNERJOIN),


RESULTABLE (INCIDENT_CD, ALS_SCN, ILS_SCN, DIAG_CD) AS
(
SELECT INCIDENT_CD, ALSATSCN AS ALS_SCN, ILSATSCN AS ILS_SCN, DIAG_CD FROM INNERJOIN
UNION ALL
SELECT	INCIDENT		AS INCIDENT_CD,
	ALSATSCN		AS ALS_SCN,
	CAST(NULL AS INTEGER) 	AS ILS_SCN,
	DIAG_CD 		AS DIAG_CD
FROM	LEFTOUTERJOIN     
UNION ALL
SELECT 	INCIDENT		AS INCIDENT_CD,
	CAST(NULL AS INTEGER)	AS ALS_SCN,
	ILSATSCN		AS ILS_SCN,
	DIAG_CD 		AS DIAG_CD
FROM RIGHTOUTERJOIN
)


SELECT 	DIAG_CD AS Diagnosis_Cd,
	INCIDENT_CD 			   AS Incident_#,
	TIME('00:00:00') + ALS_SCN SECONDS AS ALS_Scene_Time,
	TIME('00:00:00') + ILS_SCN SECONDS AS ILS_Scene_Time
FROM 	RESULTABLE
WHERE ALS_SCN IS NOT NULL
ORDER BY DIAG_CD